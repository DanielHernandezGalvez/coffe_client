---
import PostMeta from "@/components/Blog/PostMeta.astro";
import { Picture } from "astro:assets";
import { formatDate } from "@/helpers";
import Layout from "@/layouts/Layout.astro";
import { Postchema } from "@/types";
import PostCategories from "@/components/Blog/PostCategories.astro";

export const prerender = false;

const { slug } = Astro.params;
const url = `${import.meta.env.API_URL}/posts?slug=${slug}`;
const res = await fetch(url);
const json = await res.json();
const post = Postchema.safeParse(json[0]); // Validamos que el post exista
if (!post.success) return Astro.redirect("/404")
const { title, content, date, featured_images, category_details } = post.data;
---

<Layout
    title={title.rendered}
    subtitle={title.rendered}
    bgImage={featured_images.full.url}
>
    <article class="space-y-5 max-w-4xl mx-auto">
        <PostMeta date={date} />
        {category_details.map((cat) => <PostCategories name={cat.name} slug={cat.slug} />)}

        <Picture
            src={featured_images.full.url}
            alt={`Imagen del post: ${title.rendered}`}
            width={featured_images.full.width}
            height={featured_images.full.height}
            formats={["avif", "webp"]}
            class="w-full"
        />

        <div set:html={content.rendered} class="text-lg space-y-3 mt-5" />
    </article>
</Layout>
